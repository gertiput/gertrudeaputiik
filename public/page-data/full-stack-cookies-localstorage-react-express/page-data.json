{"componentChunkName":"component---src-templates-post-js","path":"/full-stack-cookies-localstorage-react-express/","result":{"data":{"markdownRemark":{"html":"<h3 id=\"the-expectation\" style=\"position:relative;\"><a href=\"#the-expectation\" aria-label=\"the expectation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The expectation</h3>\n<p>When you log into an application, you have the expectation that the next time you open a new tab or window in the browser, you will still be logged into that application. This means that in some way, shape, or form, the client (browser) must maintain a reference to you in order to keep you logged in.</p>\n<h3 id=\"where-can-i-persist-state-on-the-client\" style=\"position:relative;\"><a href=\"#where-can-i-persist-state-on-the-client\" aria-label=\"where can i persist state on the client permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Where can I persist state on the client?</h3>\n<p>Dealing with security and authentication in a front end application can be a difficult problem. There are generaly two ways to maintain state on the client in a web application:</p>\n<ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage\">Local storage</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies\">Cookies</a></li>\n</ul>\n<h3 id=\"what-are-the-vulnerabilities\" style=\"position:relative;\"><a href=\"#what-are-the-vulnerabilities\" aria-label=\"what are the vulnerabilities permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What are the vulnerabilities?</h3>\n<p>Both of these methods comes with potential related security issues:</p>\n<table>\n<thead>\n<tr>\n<th>Method</th>\n<th>Vulnerability</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Local storage</td>\n<td><strong>XSS</strong> - cross-site scripting</td>\n</tr>\n<tr>\n<td>Cookies</td>\n<td><strong>CSRF</strong> - cross-site request forgery</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>An <a href=\"https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)\"><strong>XSS</strong></a> vulnerability enables an attacker to inject JavaScript into a site.</li>\n<li>A <a href=\"https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)\"><strong>CSRF</strong></a> vulnerability enables an attacker to perform actions on a website via an authenticated user.</li>\n</ul>\n<p>A good primer on some of the differences between these two vulnerabilities and their causes can be found in <a href=\"https://stormpath.com/blog/where-to-store-your-jwts-cookies-vs-html5-web-storage\">Where to Store your JWTs â€“ Cookies vs HTML5 Web Storage</a>.</p>\n<h3 id=\"how-can-i-get-around-it\" style=\"position:relative;\"><a href=\"#how-can-i-get-around-it\" aria-label=\"how can i get around it permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How can I get around it?</h3>\n<p>If local storage can be exploited by third-party scripts (such as those found in browser extensions) and if authentication can be spoofed with cookies, where is it acceptable to place client state?</p>\n<p>In <a href=\"https://auth0.com/docs/login/spa/authenticate-with-cookies#how-it-works\">Single-Page App Authentication Using Cookies</a> on the Auth0 docs, we learn that if your application:</p>\n<ul>\n<li>is served to the client using your own backend</li>\n<li>has the same domain as your backend</li>\n<li>makes API calls that require authentication to your backend</li>\n</ul>\n<p>then there is a way to safely use cookies for authentication.</p>\n<h3 id=\"what-does-it-look-like\" style=\"position:relative;\"><a href=\"#what-does-it-look-like\" aria-label=\"what does it look like permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What does it look like?</h3>\n<p>A real-world example of the setup:</p>\n<ul>\n<li>a React single-page application (SPA) on the front end</li>\n<li>an Node + Express server backend</li>\n<li>Web Cookies (Secure, HttpOnly, Same Site)</li>\n</ul>\n<p>The Express server will serve the React SPA from all routes, except those that begin with <code class=\"language-text\">/api</code>. The React application will hit the Express server for all endpoints. With this method, your front end app is on the same domain, and has a server, allowing you to secure cookies with HttpOnly, Secure, and Same Site options.</p>\n<p>From here, you can make API calls to microservices or some protected server. The actual API endpoints and access tokens will not be visible from the browser.</p>\n<p>Below I will lay out some of the main concepts of setting up this architecture for a full stack application (without it being an actual tutorial walkthrough).</p>\n<h2 id=\"using-http-cookies-in-express\" style=\"position:relative;\"><a href=\"#using-http-cookies-in-express\" aria-label=\"using http cookies in express permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using HTTP cookies in Express</h2>\n<p>In order to use cookies in Express, you use the <a href=\"https://www.npmjs.com/package/cookie-parser\"><code class=\"language-text\">cookie-parser</code></a> module.</p>\n<h4 id=\"parse-cookies\" style=\"position:relative;\"><a href=\"#parse-cookies\" aria-label=\"parse cookies permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Parse cookies</h4>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> cookieParser <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cookie-parser'</span><span class=\"token punctuation\">)</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">cookieParser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4 id=\"set-a-cookie\" style=\"position:relative;\"><a href=\"#set-a-cookie\" aria-label=\"set a cookie permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Set a cookie</h4>\n<p>In a route, you can set a cookie on the <code class=\"language-text\">response</code> object, with some important properties:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Set a cookie</span>\nresponse<span class=\"token punctuation\">.</span><span class=\"token function\">cookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">'nameOfCookie'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'cookieValue'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  maxAge<span class=\"token operator\">:</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 1 hour</span>\n  httpOnly<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  secure<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  sameSite<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/HTTP_cookie#SameSite_cookie\"><strong>Same Site</strong></a> - prevents the cookie from being sent in cross-site requests</li>\n<li><a href=\"https://en.wikipedia.org/wiki/HTTP_cookie#HttpOnly_cookie\"><strong>HTTP Only</strong></a> - cookies are only accessible from a server</li>\n<li><a href=\"https://en.wikipedia.org/wiki/Secure_cookie\"><strong>Secure</strong></a> - cookie must be transmitted over HTTPS</li>\n</ul>\n<h4 id=\"get-a-cookie\" style=\"position:relative;\"><a href=\"#get-a-cookie\" aria-label=\"get a cookie permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Get a cookie</h4>\n<p>The cookie can now be read in subsequent responses.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Get a cookie</span>\nresponse<span class=\"token punctuation\">.</span>cookies<span class=\"token punctuation\">.</span>nameOfCookie</code></pre></div>\n<h4 id=\"clear-a-cookie\" style=\"position:relative;\"><a href=\"#clear-a-cookie\" aria-label=\"clear a cookie permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Clear a cookie</h4>\n<p>On logging out of the authentication, you'll want to clear the cookies.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Clear a cookie</span>\nresponse<span class=\"token punctuation\">.</span><span class=\"token function\">clearCookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">'nameOfCookie'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4 id=\"local-values-in-express-middleware\" style=\"position:relative;\"><a href=\"#local-values-in-express-middleware\" aria-label=\"local values in express middleware permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Local values in Express middleware</h4>\n<p>Express runs on middlewares. In the case that you want to update a cookie in one middleware and use it in the next, you can store it as an Express local. This might come in handy if you have to refresh a JWT access token in a preAuth route, use that authentication in the handler, and send cookies in the response at the end.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Create a local</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">refreshMiddleware</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> accessToken <span class=\"token operator\">=</span> <span class=\"token function\">getNewAccessToken</span><span class=\"token punctuation\">(</span>refreshToken<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// Set local</span>\n  response<span class=\"token punctuation\">.</span>locals<span class=\"token punctuation\">.</span>accessToken <span class=\"token operator\">=</span> accessToken\n  <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Use a local</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> updatedAccessToken <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>locals<span class=\"token punctuation\">.</span>accessToken\n<span class=\"token punctuation\">}</span>\n\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/app/user'</span><span class=\"token punctuation\">,</span> refreshMiddleware<span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"serving-the-front-end-app\" style=\"position:relative;\"><a href=\"#serving-the-front-end-app\" aria-label=\"serving the front end app permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Serving the front end app</h2>\n<p>A good example of this setup can be found in the <a href=\"https://github.com/crsandeep/simple-react-full-stack\">Simple React Full Stack</a> boilerplate setup. Ultimately, here's what the layout of your application will look like:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">dist     <span class=\"token comment\"># Distribution folder of the production React SPA build</span>\nsrc\n  client <span class=\"token comment\"># React source files</span>\n  server <span class=\"token comment\"># Express server files</span></code></pre></div>\n<p>In which case, your server file will look something like this:</p>\n<div class=\"filename\">src/server/index.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Initialize Express app</span>\n<span class=\"token keyword\">const</span> express <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token function\">express</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./router'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Serve all static files from the dist folder</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>express<span class=\"token punctuation\">.</span><span class=\"token function\">static</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'../../dist/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Set up express router to serve all api routes (more on this below)</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api'</span><span class=\"token punctuation\">,</span> router<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Serve any other file as the distribution index.html</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  response<span class=\"token punctuation\">.</span><span class=\"token function\">sendFile</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'../../dist/index.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"express-routes-and-handlers\" style=\"position:relative;\"><a href=\"#express-routes-and-handlers\" aria-label=\"express routes and handlers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Express routes and handlers</h2>\n<p>Using the <a href=\"https://expressjs.com/en/guide/routing.html\">Express Router class</a>, you can organize all your API routes into subdirectories and bring them in with a single line in the main server entry point.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">src\n  server\n    router\n    handlers\n    index.js</code></pre></div>\n<p>The routes can all be organized into individual subdirectories.</p>\n<div class=\"filename\">src/server/routes/index.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> bookRoutes <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./books'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> authorRoutes <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./authors'</span><span class=\"token punctuation\">)</span>\n\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/books'</span><span class=\"token punctuation\">,</span> bookRoutes<span class=\"token punctuation\">)</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/authors'</span><span class=\"token punctuation\">,</span> authorRoutes<span class=\"token punctuation\">)</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> router</code></pre></div>\n<p>In one set of routes, we can define all the <code class=\"language-text\">GET</code>, <code class=\"language-text\">POST</code>, <code class=\"language-text\">DELETE</code> routes, etc. Since the router is using <code class=\"language-text\">/api</code>, and the authors route is using <code class=\"language-text\">/authors</code>, a GET API call to <code class=\"language-text\">/api/authors/jk-rowling</code> would call the <code class=\"language-text\">getAuthor</code> handler, in this example.</p>\n<div class=\"filename\">src/server/routes/authors.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'express'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Router</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> authorHandlers <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'../handlers/authors'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Get</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> authorHandlers<span class=\"token punctuation\">.</span>getAllAuthors<span class=\"token punctuation\">)</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/:author'</span><span class=\"token punctuation\">,</span> authorHandlers<span class=\"token punctuation\">.</span>getAuthor<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Post</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">,</span> authorHandlers<span class=\"token punctuation\">.</span>addAuthor<span class=\"token punctuation\">)</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> router</code></pre></div>\n<p>You can put all your related author handlers in the <code class=\"language-text\">handlers</code> subdirectory.</p>\n<div class=\"filename\">src/server/handlers/authors.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">getAllAuthors</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Some logic...</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>success<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      response<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>authors<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      response<span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> message<span class=\"token operator\">:</span> <span class=\"token string\">'Something went wrong'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">addAuthor</span><span class=\"token operator\">:</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">request<span class=\"token punctuation\">,</span> response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This brings us back to the server entrypoint, which is bringing in all the routes for <code class=\"language-text\">/api</code>.</p>\n<div class=\"filename\">src/server/index.js</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Set up all API routes</span>\n<span class=\"token keyword\">const</span> router <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./router'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Use all API routes</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api'</span><span class=\"token punctuation\">,</span> router<span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"react-single-page-application\" style=\"position:relative;\"><a href=\"#react-single-page-application\" aria-label=\"react single page application permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>React Single Page Application</h2>\n<p>Tyler McGinnis has a great article about <a href=\"https://tylermcginnis.com/react-router-protected-routes-authentication/\">Protected Routes and Authentication with React Router</a>, which demonstrates how you can make a <code class=\"language-text\">PrivateRoute</code> and <code class=\"language-text\">PublicRoute</code> component.</p>\n<p>This is front-end only authentication protection, which can not be trusted to protect sensitive data - that should be protected by the backend APIs that require access tokens (or whatever security method) to return a response.</p>\n<p>Using the basic example of routes from the aforementioned article, here's how you can make an API call to the Express server from React, authenticate some global <a href=\"/using-context-api-in-react/\">Context</a> state, and route the app through the front end.</p>\n<div class=\"filename\">App.js</div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> React<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> Component <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> BrowserRouter <span class=\"token keyword\">as</span> Router<span class=\"token punctuation\">,</span> Switch<span class=\"token punctuation\">,</span> Route<span class=\"token punctuation\">,</span> Redirect <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-router-dom'</span>\n<span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span>\n<span class=\"token comment\">// ...plus page and context imports</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">App</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">static</span> contextType <span class=\"token operator\">=</span> AuthContext\n\n  state <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> loading<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">async</span> <span class=\"token function\">componentDidMount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> Auth <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>context\n\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">axios</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/auth'</span><span class=\"token punctuation\">)</span>\n\n      Auth<span class=\"token punctuation\">.</span><span class=\"token function\">authenticate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> loading<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> Auth <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>context\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> loading <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>state\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>loading<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Loading...</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Router</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Switch</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">PublicRoute</span></span> <span class=\"token attr-name\">exact</span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/login<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">component</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>LoginPage<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProtectedRoute</span></span> <span class=\"token attr-name\">exact</span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/dashboard<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">component</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>DashboardPage<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Route</span></span> <span class=\"token attr-name\">exact</span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/logout<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">component</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>LogoutPage<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Redirect</span></span> <span class=\"token attr-name\">to</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/login<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Switch</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Router</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now the development server will direct you to the correct route depending on your authentication status. In production mode, the distribution <code class=\"language-text\">index.html</code> file will be served - more on this below.</p>\n<h2 id=\"production-and-development\" style=\"position:relative;\"><a href=\"#production-and-development\" aria-label=\"production and development permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Production and Development</h2>\n<p>With the production setup, an entire React application is built for distribution, and the Express app serves the SPA on all routes.</p>\n<div class=\"filename\">package.json</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Production</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env NODE_ENV=production webpack --config config/webpack.prod.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npm run build &amp;&amp; node src/server/index.js\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This is cumbersome for development. The best way to deal with development is to serve React on a Webpack dev server just as you regularly would, and proxy all API requests to the Express server.</p>\n<div class=\"filename\">package.json</div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Development</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"client\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"cross-env NODE_ENV=development webpack-dev-server --config config/webpack.dev.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"server\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"nodemon src/server/index.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"concurrently \\\"npm run server\\\" \\\"npm run client\\\"\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You'll probably serve the React app on port <code class=\"language-text\">3000</code> and the server on <code class=\"language-text\">5000</code>, which can be set in the development Webpack config file.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">devServer<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  historyApiFallback<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  proxy<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'/api'</span><span class=\"token operator\">:</span> <span class=\"token string\">'http://localhost:5000'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  open<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  compress<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  hot<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  port<span class=\"token operator\">:</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Setting <code class=\"language-text\">historyApiFallback</code> will ensure the SPA routes work properly. It's also important to set the <code class=\"language-text\">publicPath</code> in Webpack to <code class=\"language-text\">/</code>, to ensure the routes in production serve the bundles from the root.</p>\n<p>The <code class=\"language-text\">Webpack Boilerplate</code> is a good example to use for how to set up Webpack (in this case, you would just move everything from building directly to <code class=\"language-text\">src</code> to building to <code class=\"language-text\">src/client</code>).</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>Hopefully this resource helped you understand the various types of vulnerabilities associated with persistent client-side storage (XSS and CSRF), and some approaches we can take to mitigate potential attacks, namely HttpOnly, SameSite, Secure Web Cookies.</p>\n<p>If you have any additional insight that can make this article better, please don't hesitate to let me know.</p>","timeToRead":9,"excerpt":"The expectation When you log into an application, you have the expectation that the next time you open a new tab or window in the browserâ€¦","frontmatter":{"title":"Full Stack Authentication: Cookies and Local Storage","thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAFPUlEQVQ4y12VCVBTRxzGH9Ip4zidjnWs17TOtN6iFpzKeFFGkVZFEFEQ0EGoAoZDKYYIiBzhikhrQasIioCCBjkC4QiIRsKNikXAIDCCJCRcCYg6Ngn79eWhqdOd2Xn/t7v/337f7r59FEWXlXNmUxVpXH1InbSxomRP7xoDMKI+FDqm/l9UvSLjOn4kE493l1Bcb5vpDhNjI4qzcy0TJx2zp378JGmoU2gx+Exw6Fqob1Uyy62mPu+878vmO5uyww598XFMb/0NZmKNopriuG6lqIaCWKYjjeNGfVQ19Fy4b0haWi17yp962y+E8AILPLct6BD9gbEXAig7C3uHnwtYH6Gy1jszmOeT7OkGrw3fGGxxdm66Js48izfSTMjEsWRIEqNTN/F0Ey2JOnVzok5ZFz8lb7wKlbQYw1KBWHAxaDajtCmLgVLhbluoe1kxjLKHfB4rn/crekqCiaomUjNWwyUqSQxR18YSdV0c1LVxZLIpgVxnu+rC7TZqlE2XIG/jN7Ad1pvo8+sLEoyoLslVhizJ51mOtmfjXet59JdHT4mSAzFQdpqMPIgko+JoqGpjMfqQS9T0BH1CDvLC7UndFY9/3nWm40lFSrye8X6gbIbBqlScIpps4WGokq3lOm5EtONmGhaB4QeRNOgDUBwFfZu6lkte13MxUh1KlPdC8Krhkq5WkPSDYTeLbkSteFXDe6+qDoZCFEzPfIR08v2hqtEDIjFCKxyticF4vd52NCbqomkYhygq2FBUBGnetybhSfl5jgH4tJwX9raRiwEBSztUxSaTdRFkvDYK8qpIKKsjaZXRUNcnoLuIg9wz7hBf9EE7P5R2E0wGywN1byRh6KqMExqArXfZqe8kHPTyj2mHK0+RjhxvpPrZIYXljJelZ6BuSMREcxLabgchaPsqZLH30MdoG17wWWSkKkg3cT8I3aUhbTRq+mOQXHZOeX3PH7Li41plxQnSJwjAnbA9KE1wwVgdD2MNSUwdb0yEglasrApBS7o7XhayiLLMX6eqDEBbjtcjGjV9dIRxNrzh4iMYLPHWygQ+RCYMIGMPQjHZGI/RWh5UzSl0Tabh56CScCEvZ0NeEgC50JfIS3x0atFx1F/eV2mw/Lv3Bqf263aQFbhP9eV5EFopUZT/BnnFaQyLY6Bq+hPjLcmQV8dgsPIMlKJTtBtfIhN44VW+h3ao6DAKIyzTDcCFs+bMEXIt+7pu7EX/XRqa7wlluR8ZLAvEoCgEyvuRUFSF43GWH4pjDmBYdILIio6SZ5lHSHuGs67l4g5EuJjuZ2DKQkfGd5TrGk7rX9bovblX25PrQh6lHoQ0x5MMFPuim++DrlwvyEsDIM31YGDS7IM4bb1aU8TZjFsci2oa8RkD/Hn1go9CZ17xNW9sT92OnixbTcslW9KR4QR5oTuRFXqS/gJP0nP7MOm+5YreHCfSk22vyQkwQ9SBFYqjNkvM9YCzB02ndznQbiUTWC2du5bnvuZvSeJWdKTRarN3a6XZzrrOjH1Tvbccpmj1uq6MXdr2q9ak+YIl0gLMB102L96qzxWds5reYSjZzDPWfR0D/drYZNHJXUsyU33NNHmn1iPBdQcE4VZou/ITJIlbcD9+E9L9zRDmuFy88duvGGXSm7sNlzFlvWyuIT7rbGro+MV0/jYn84WpLmbzJOH7l/fGHVot49gve8yy+S7Tdt0CB/0S6cdlBVsYcmxN6eVbNfdzavvS/6AO5ouMPr3yrbetmrnIZObC+cYmi+nXLz/9Dfjt/N4A22U6j7KYP4v6F0OaM6s9eql1AAAAAElFTkSuQmCC","width":150,"height":150,"src":"/static/d46d5640598e2cbc03373885d2226c51/4148e/cookie.png","srcSet":"/static/d46d5640598e2cbc03373885d2226c51/4148e/cookie.png 1x,\n/static/d46d5640598e2cbc03373885d2226c51/de03e/cookie.png 1.5x"}}},"slug":"full-stack-cookies-localstorage-react-express","date":"2019-10-29T00:00:00.000Z","categories":["Code"],"tags":["javascript","react","node","express","cookies"],"template":"post"},"fields":{"slug":"/full-stack-cookies-localstorage-react-express/","date":"2019-10-29T00:00:00.000Z"}}},"pageContext":{"slug":"/full-stack-cookies-localstorage-react-express/"}}}