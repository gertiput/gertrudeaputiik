{"componentChunkName":"component---src-templates-post-js","path":"/how-to-integrate-gsuite-saml-with-angular/","result":{"data":{"markdownRemark":{"html":"<p> SAML: Security Assertion Markup Language is a means exchanging authorization and authentication information between entities which is the Service Provider(SP) and the Identity Provider(IdP).</p>\n<h3 id=\"some-terminologies\"><a href=\"#some-terminologies\" aria-label=\"some terminologies permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Some Terminologies</h3>\n<p>Authentication is validating the credentials of an entity by verifying his user name and password to prove his identity. Authentication systems in a nutshell determines whether you are what you say you are using your credentials provided.</p>\n<p>Authorization which is normally done after authentication and it grants an entity permission to access certain resources on a system. This could be databases or simple files. </p>\n<p>Service provider(SP) is a services that are requesting  authentication and identity information about user. In our case this is our node(angular) application Service providers take authentication responses received from  identity providers and use that information to create and configure sessions.</p>\n<p>Identity Provider(IdP) is a service that serves as the source of identity information and authentication decision. Identity providers authenticate users and return identity information to service providers. In our case this is Google.</p>\n<p>HTTP Bindings are the means by which data is exchanged between the SP and the IdP. The usual ones our application will use HTTP POST and HTTP redirect bindings.</p>\n<h3 id=\"authentication-flows\"><a href=\"#authentication-flows\" aria-label=\"authentication flows permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authentication flows.</h3>\n<p>Lets say we have an angular application called <code class=\"language-text\">Oh yes</code> which is owned by a company, successfully deployed and must be used by  its employees only.</p>\n<p>To begin the login process,</p>\n<p><code class=\"language-text\">The user tries to log in to ```Oh yes``` from a browser.</code>\n<code class=\"language-text\">```Oh yes``` responds by generating a SAML Authentication Request. The ```Authentication Request``` is often sent using HTTP Redirect Binding, and ends up looking something like this</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 850px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ee64d018685210a7262308ff1b106a1c/3e755/saml.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 12.231404958677686%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAAsSAAALEgHS3X78AAAAZElEQVQI1x2JUQqAIBBEu//V+igrcHWlLOsngiAC21awzWF482CqYz/O6watVQ8WwKIbwIHBttMWfdsPdaMMjkvYJh9EwAXAMM2rtMo5J07xKSEqLHgpPpGIXgmzDBVhFvwu1wdulm4d1jQMrAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"saml\"\n        title=\"saml\"\n        src=\"/static/ee64d018685210a7262308ff1b106a1c/4d3f1/saml.png\"\n        srcset=\"/static/ee64d018685210a7262308ff1b106a1c/0cb30/saml.png 213w,\n/static/ee64d018685210a7262308ff1b106a1c/a67b6/saml.png 425w,\n/static/ee64d018685210a7262308ff1b106a1c/4d3f1/saml.png 850w,\n/static/ee64d018685210a7262308ff1b106a1c/3e755/saml.png 1210w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">The IdP(Google) parses the SAML request, authenticates the user and generates a SAML response.</code>\n<code class=\"language-text\">The IdP(Google) returns the encoded SAMLResponse to the browser if everything goes well as expected. A simplified SAMLResponse would look like this:</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 850px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3709785e3a8fb2fde3b2120e6075161b/245a8/saml3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.531120331950206%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABB0lEQVQY02WQiW6DMAyG8/5POGm0QA5ykfsgQAv1qFRNm/Xpt2XptxOjtj2O8/zwN47zePN8x08+DtBjXXdECRNccsblJBnXdJKYTNAbMBtGyqXmQgtljA2AvdS4mPICoDJ1Wdwz+yr8bpQaCadM9iO7Zs6zDT5kYGn7b+qylbqiRfZV4Sq6JvvoHCwjlMN+66LzyfporiKm+s+/o1Xdmh6a+F5VH60hTFImJqGtS7AwxBJShReGCObHuj0/gB9JghWjAo+KErB1Pbnd8TAyTOEOajbe2Hh9OOrZKW1BtfHQh9Fokk7OwfhqY/WhOB/hKtYF50E9XCaXCqRUoE4ZtKRcW9uWZXsBVCSKVbZyWG0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"saml3\"\n        title=\"saml3\"\n        src=\"/static/3709785e3a8fb2fde3b2120e6075161b/4d3f1/saml3.png\"\n        srcset=\"/static/3709785e3a8fb2fde3b2120e6075161b/0cb30/saml3.png 213w,\n/static/3709785e3a8fb2fde3b2120e6075161b/a67b6/saml3.png 425w,\n/static/3709785e3a8fb2fde3b2120e6075161b/4d3f1/saml3.png 850w,\n/static/3709785e3a8fb2fde3b2120e6075161b/245a8/saml3.png 1205w\"\n        sizes=\"(max-width: 850px) 100vw, 850px\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">The browser sends the SAML response to Oh yes for verification.</code>\n<code class=\"language-text\">If the verification is successful, the user will be logged in to Oh yes and granted access to all the various resources.</code></p>\n<h3 id=\"authentication-flows-diagram\"><a href=\"#authentication-flows-diagram\" aria-label=\"authentication flows diagram permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Authentication flows diagram.</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 715px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/10291d84bb3ed77708147faba5a7a2fd/2a207/saml4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.3076923076923%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAABMElEQVQoz7WSPUsDQRCG85Osba0FSSMSBLG0sdHWX2FtK4ilgiBY2SgxCGIj5FCE3F3uK3f7PbO359ypgUDOGMSBhYWZd+adZ7dT/SE6bQlrrZJKSskZQ8DlxAbAT5KcC84l/F7s6JRlwORdMHpPvCq9rqQ3zbSKyybIsEXUaAOmNUhnxs7B4smkEkIYY+gihZix434UlwigVV4wpTVNphaLabumZ5xm67v7ve728ebK4+lhDcxoxhhlaREDGKTWYF0prFaoZ8Vx0t3ZW93oHWyt3Z4cEdx8MiHzzQpQFPLmqQqv7ivv/GzwNry4pN5uartekrOHQf/Fe8WyJkc93XdQgTRl5odFMnoepkWcfaL/EhNixrkBo5Vy8+BQwTiK/DACLdBi+zvPJbvUD/t38QfvcCuDdh4dtgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"saml4\"\n        title=\"saml4\"\n        src=\"/static/10291d84bb3ed77708147faba5a7a2fd/2a207/saml4.png\"\n        srcset=\"/static/10291d84bb3ed77708147faba5a7a2fd/0cb30/saml4.png 213w,\n/static/10291d84bb3ed77708147faba5a7a2fd/a67b6/saml4.png 425w,\n/static/10291d84bb3ed77708147faba5a7a2fd/2a207/saml4.png 715w\"\n        sizes=\"(max-width: 715px) 100vw, 715px\"\n      />\n  </a>\n    </span></p>\n<p>To start with the integration, contact the G suite admin to create a SAML application. In order for him or her to create the application, you must provide <code class=\"language-text\">ACS URL path</code>. In return you would receive an <code class=\"language-text\">SSO URL</code>, an <code class=\"language-text\">ISSUER ID</code> and <code class=\"language-text\">certificate</code> to use in our node entry point file.</p>\n<p>In order for the above to work for in our application, we employ the use of some node dependencies such as.</p>\n<ol>\n<li><a href=\"https://github.com/bergie/passport-saml\">passport - Saml</a>: Authentication provider for Passport </li>\n<li><a href=\"https://github.com/expressjs/body-parser#readme\">body-parser</a>: Node js body parsing middleware.</li>\n<li><a href=\"https://github.com/expressjs/cookie-parser#readme\">cookie-parser</a>: Parsing Cookie headers in our application.</li>\n</ol>\n<p>Take a look at the below code  for more :)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">server.js\n//Install express server\nconst express = require(&quot;express&quot;);\nconst path = require(&quot;path&quot;);\nconst SamlStrategy = require(&quot;passport-saml&quot;).Strategy;\nconst passport = require(&quot;passport&quot;);\nconst bodyParser = require(&quot;body-parser&quot;);\nconst cookieSession = require(&quot;cookie-session&quot;);\nconst cookieParser = require(&quot;cookie-parser&quot;);\nlet userEmail = &quot;&quot;;\nconst app = express();\n// Serve only the static files form the dist directory\napp.use(express.static(__dirname + &quot;/dist/tpms&quot;));\n\napp.use(cookieParser());\napp.use(\n  cookieSession({\n    name: &quot;dummySession&quot;,\n    keys: [&quot;super secret&quot;],\n    maxAge: 2 * 24 * 60 * 60 * 1000 // 2 days\n  })\n);\napp.use(bodyParser.json());\napp.use(passport.initialize());\napp.use(passport.session());\n\npassport.use(\n  new SamlStrategy(\n    {\n      protocol: &quot;https://&quot;,\n      entryPoint: process.env.ENTRY_POINT, // SSO URL (Step 2)\n      issuer: process.env.ISSUER, // Entity ID (Step 4)\n      path: &quot;/auth/saml/callback&quot;, // ACS URL path (Step 4)\n      cert: process.env.CERT\n    },\n    function (profile, done) {\n      // Parse user profile data\n      userEmail = profile.nameID;\n      return done(null, {\n        email: profile.email,\n        name: profile.name\n      });\n    }\n  )\n);\npassport.serializeUser(function (user, done) {\n  done(null, user);\n});\n\npassport.deserializeUser(function (user, done) {\n  done(null, user);\n});\n\napp.get(\n  &quot;/login&quot;,\n  passport.authenticate(&quot;saml&quot;, {\n    successRedirect: &quot;/&quot;,\n    failureRedirect: &quot;/login&quot;\n  })\n);\n\napp.get(&quot;/logout&quot;, function (req, res) {\n  res.clearCookie(&#39;ttemail&#39;)\n  req.logout();\n  res.redirect(&quot;https://turntabl.io&quot;);\n  // res.end(&quot;You have logged out.&quot;);\n});\n\napp.post(\n  &quot;/auth/saml/callback&quot;,\n  bodyParser.urlencoded({ extended: false }),\n  passport.authenticate(&quot;saml&quot;, {\n    failureRedirect: &quot;/error&quot;,\n    failureFlash: false\n  }),\n  function (req, res) {\n    // sets a cookie called ttemail and sets its max age to 1 day\n    res.cookie(&#39;ttemail&#39;, userEmail, { maxAge: 1 * 24 * 60 * 60 * 1000, secure: true, httpOnly: false })\n    res.redirect(&quot;https://tpms-ui.herokuapp.com/verify&quot;);\n  }\n);\n\napp.all(&quot;*&quot;, function (req, res, next) {\n  if (req.isAuthenticated() || process.env.NODE_ENV !== &quot;production&quot;) {\n    next();\n  } else {\n    res.redirect(&quot;/login&quot;);\n  }\n});\napp.get(&quot;/*&quot;, function (req, res) {\n  res.sendFile(path.join(__dirname + &quot;/dist/tpms/index.html&quot;));\n});\n\n// Start the app by listening on the default Heroku port\napp.listen(process.env.PORT || 8080);</code></pre></div>","timeToRead":4,"excerpt":"SAML: Security Assertion Markup Language is a means exchanging authorization and authentication information between entities which is theâ€¦","frontmatter":{"title":"How to integrate gsuite saml with angular","thumbnail":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABNElEQVQoz6VSS07DMBDNAXoRlizhEByhXKBbNuwRO1ghdgipFygSSLBBtGpVWpBaKAYKaQiVlTbkQ3BKPnbGJm52pKmEGHkxHvnNvDfPivhHKL/uPD18nrAkvGhPtvan1dPE/56X+DIwlyEEQJpHXaQqK0Zlp1FaxXvVrF0hmMupIohgbFFCBe0947VNclIfbFQmxzX5ICkGJyCGBrvW4tep8J60+E33do9QaV0rbzNsSjAU0ub31sjwqdPsXD7qtovDzi3YLmkPukOzadEXJ8yrVjK2TvR5Zz/I+aiu6Yc4NEUUM7XV8cWIsI8ZPdOITyHb6ALayFORi5KgB+QG/D7zriB+b+EAk6h8Pj7o28vAcmwqCxjnCecslZhWKPCa+tXAs5xNi3zOuf6XT5KPdMdQ0OQH8kFxCQSuPqkAAAAASUVORK5CYII=","width":150,"height":150,"src":"/static/d0669ceef16beacfa989a3303b0c4276/4148e/gsuite.png","srcSet":"/static/d0669ceef16beacfa989a3303b0c4276/4148e/gsuite.png 1x,\n/static/d0669ceef16beacfa989a3303b0c4276/de03e/gsuite.png 1.5x,\n/static/d0669ceef16beacfa989a3303b0c4276/1e9e2/gsuite.png 2x"}}},"slug":"how-to-integrate-gsuite-saml-with-angular","date":"2020-01-16T00:00:00.000Z","categories":["Code"],"tags":["gsuite","saml"],"template":"post"},"fields":{"slug":"/how-to-integrate-gsuite-saml-with-angular/","date":"2020-01-16T00:00:00.000Z"}}},"pageContext":{"slug":"/how-to-integrate-gsuite-saml-with-angular/"}}}